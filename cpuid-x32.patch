--- cpuid-20150606/cpuid.c.orig	2015-06-07 02:03:14.000000000 +0200
+++ cpuid-20150606/cpuid.c	2015-06-26 23:16:36.966332168 +0200
@@ -3367,7 +3367,7 @@
 static int bits_needed(unsigned long  v)
 {
    int  result;
-#ifdef __x86_64
+#if defined(__x86_64) && !defined(__ILP32__)
    asm("movq %[v],%%rax;"
        "movq $0,%%rcx;"
        "movl $0,%[result];"
